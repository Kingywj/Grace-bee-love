(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-13b8dfe8"],{"29a2":function(e,t,a){},"2d45":function(e,t,a){},4320:function(e,t,a){"use strict";a.r(t);function r(e,t,a){/^[1][3,4,5,6,7,8][0-9]{9}$/.test(t)?a():a(new Error("手机号格式错误"))}var s=a("365c"),i={name:"departmentChoose",props:{},data:function(){return{selectDep:[],department:[]}},methods:{initDepartmentData:function(){var t=this;Object(s.U)().then(function(e){e.success&&(e=e.result,t.filterData(e),t.department=e)})},handleChangeDep:function(e,t){var a="";e&&0<e.length&&(a=e[e.length-1]),this.$emit("on-change",a)},clearSelect:function(){this.selectDep=[]},filterData:function(e){var t=this;e.forEach(function(e){e.value=e.id,e.label=e.title,e.children&&t.filterData(e.children)})}},created:function(){this.initDepartmentData()}},n=a("2877"),i=Object(n.a)(i,function(){var t=this,e=t._self._c;return e("div",[e("Cascader",{attrs:{data:t.department,"change-on-select":"",filterable:"",clearable:"",placeholder:"请选择"},on:{"on-change":t.handleChangeDep},model:{value:t.selectDep,callback:function(e){t.selectDep=e},expression:"selectDep"}})],1)},[],!1,null,null,null).exports,o={name:"departmentTreeChoose",props:{multiple:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},placeholder:{type:String,default:"点击选择部门"}},data:function(){return{depLoading:!1,departmentTitle:"",searchKey:"",dataDep:[],selectDep:[],departmentId:[]}},methods:{initDepartmentData:function(){var t=this;Object(s.U)().then(function(e){e.success&&(t.dataDep=e.result)})},searchDep:function(){var t=this;this.searchKey?(this.depLoading=!0,Object(s.db)({title:this.searchKey}).then(function(e){t.depLoading=!1,e.success&&(e.result.forEach(function(e){-1==e.status&&(e.title="[已禁用] "+e.title,e.disabled=!0)}),t.dataDep=e.result)})):this.initDepartmentData()},selectTree:function(e){0===e.length?(this.$emit("on-change",null),this.departmentId="",this.departmentTitle=""):(this.departmentId=e[0].id,this.departmentTitle=e[0].title,e={departmentId:this.departmentId,departmentTitle:this.departmentTitle},this.$emit("on-change",e))},clearSelect:function(){this.departmentId=[],this.departmentTitle="",this.initDepartmentData(),this.multiple?this.$emit("on-change",[]):this.$emit("on-change",""),this.$emit("on-clear")},setData:function(e,t){this.departmentTitle=t,this.multiple?this.departmentId=e:(this.departmentId=[],this.departmentId.push(e))}},created:function(){this.initDepartmentData()}};a("7da6");i={name:"user-manage",components:{departmentChoose:i,departmentTreeChoose:Object(n.a)(o,function(){var t=this,e=t._self._c;return e("div",[e("div",{staticStyle:{display:"flex"}},[e("Input",{staticStyle:{"margin-right":"10px"},attrs:{readonly:"",placeholder:t.placeholder,clearable:t.clearable},on:{"on-clear":t.clearSelect},model:{value:t.departmentTitle,callback:function(e){t.departmentTitle=e},expression:"departmentTitle"}}),e("Poptip",{attrs:{transfer:"",trigger:"click",placement:"right",title:"选择部门",width:"250"}},[e("Button",{attrs:{icon:"md-list"}},[t._v("选择部门")]),e("div",{attrs:{slot:"content"},slot:"content"},[e("Input",{attrs:{suffix:"ios-search",placeholder:"输入部门名搜索",clearable:""},on:{"on-change":t.searchDep},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),e("div",{staticClass:"dep-tree-bar"},[e("Tree",{attrs:{data:t.dataDep},on:{"on-select-change":t.selectTree}}),t.depLoading?e("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)],1)],1)],1)])},[],!1,null,"929657fc",null).exports,uploadPicInput:a("da7e").a},data:function(){var s=this;return{loading:!0,selectCount:0,selectList:[],searchForm:{username:"",departmentId:"",mobile:"",pageNumber:1,pageSize:10,sort:"createTime",order:"desc"},modalType:0,userModalVisible:!1,modalTitle:"",form:{username:"",mobile:"",email:"",sex:"",roles:[],departmentId:0,departmentTitle:""},roleList:[],errorPass:"",formValidate:{username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}],mobile:[{required:!0,message:"手机号不能为空",trigger:"blur"},{validator:r,trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址"},{type:"email",message:"邮箱格式不正确"}]},submitLoading:!1,columns:[{type:"selection",width:60,align:"center",fixed:"left"},{title:"用户名",key:"username",minWidth:120,sortable:!0,fixed:"left"},{title:"头像",key:"avatar",width:80,align:"center",render:function(e,t){return e("Avatar",{props:{src:t.row.avatar}})}},{title:"手机",key:"mobile",width:125},{title:"邮箱",key:"email",minWidth:180,sortable:!0},{title:"状态",key:"status",align:"center",width:110,render:function(e,t){return 1==t.row.status?e("div",[e("Badge",{props:{status:"success",text:"启用"}})]):0==t.row.status?e("div",[e("Badge",{props:{status:"error",text:"禁用"}})]):void 0},filters:[{label:"启用",value:!0},{label:"禁用",value:!1}],filterMultiple:!1,filterMethod:function(e,t){return t.status==e}},{title:"创建时间",key:"createTime",sortable:!0,sortType:"desc",width:180},{title:"操作",key:"action",width:200,align:"center",fixed:"right",render:function(e,t){var a=1==t.row.status?e("Button",{props:{size:"small"},style:{marginRight:"5px"},on:{click:function(){s.disable(t.row)}}},"禁用"):e("Button",{props:{type:"success",size:"small"},style:{marginRight:"5px"},on:{click:function(){s.enable(t.row)}}},"启用");return e("div",[e("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){s.edit(t.row)}}},"编辑"),a,e("Button",{props:{type:"error",size:"small"},on:{click:function(){s.remove(t.row)}}},"删除")])}}],data:[],total:0}},methods:{init:function(){this.getUserList()},handleSelectDepTree:function(e){e?(this.form.departmentId=e.departmentId,this.form.departmentTitle=e.departmentTitle):(this.form.departmentId=0,this.form.departmentTitle="")},handleSelectDep:function(e){this.searchForm.departmentId=e},changePage:function(e){this.searchForm.pageNumber=e,this.getUserList(),this.clearSelectAll()},changePageSize:function(e){this.searchForm.pageSize=e,this.searchForm.pageNumber=1,this.getUserList()},getUserList:function(){var t=this;this.loading=!0,Object(s.P)(this.searchForm).then(function(e){t.loading=!1,e.success&&(t.data=e.result.records,t.total=e.result.total)})},handleSearch:function(){this.searchForm.pageNumber=1,this.searchForm.pageSize=10,this.getUserList()},changeSort:function(e){this.searchForm.sort=e.key,this.searchForm.order=e.order,"normal"==e.order&&(this.searchForm.order=""),this.getUserList()},getRoleList:function(){var t=this;Object(s.z)({pageSize:100}).then(function(e){e.success&&(t.roleList=e.result.records)})},resetPass:function(){var a=this;0!=this.selectCount?this.$Modal.confirm({title:"确认重置",content:"您确认要重置所选的 "+this.selectCount+" 条用户数据密码为【123456】?",loading:!0,onOk:function(){var t="";a.selectList.forEach(function(e){t+=e.id+","}),t=t.substring(0,t.length-1),Object(s.bb)(t).then(function(e){a.$Modal.remove(),e.success&&(a.$Message.success("操作成功"),a.clearSelectAll(),a.getUserList())})}}):this.$Message.warning("请选中数据后重试!")},submitUser:function(){var t=this;this.$refs.form.validate(function(e){e&&(0==t.modalType?(delete(e=JSON.parse(JSON.stringify(t.form))).id,delete e.status,""==e.password||null==e.password?t.errorPass="密码不能为空":e.password.length<6?t.errorPass="密码长度不得少于6位":(e.password=t.md5(e.password),t.submitLoading=!0,Object(s.f)(e).then(function(e){t.submitLoading=!1,e.success&&(t.$Message.success("操作成功"),t.getUserList(),t.userModalVisible=!1)}))):(t.submitLoading=!0,Object(s.u)(t.form).then(function(e){t.submitLoading=!1,e.success&&(t.$Message.success("操作成功"),t.getUserList(),t.userModalVisible=!1)})))})},add:function(){this.modalType=0,this.modalTitle="添加用户",this.$refs.form.resetFields(),this.form={username:"",mobile:"",email:"",sex:"",roles:[],departmentId:0,departmentTitle:""},this.$refs.depTree.setData("",""),this.userModalVisible=!0},edit:function(e){for(var t in this.form=JSON.parse(JSON.stringify(e)),this.modalType=1,this.modalTitle="编辑用户",this.$refs.form.resetFields(),this.form)null==this.form[t]&&(this.form[t]="");this.$refs.depTree.setData(this.form.departmentId,this.form.departmentTitle);var a=[];this.form.roles&&this.form.roles.forEach(function(e){a.push(e.id)}),this.form.roles=a,this.userModalVisible=!0},enable:function(e){var t=this,a={status:!0};this.$Modal.confirm({title:"确认启用",content:"您确认要启用用户 "+e.username+" ?",loading:!0,onOk:function(){Object(s.x)(e.id,a).then(function(e){t.$Modal.remove(),e.success&&(t.$Message.success("操作成功"),t.getUserList())})}})},disable:function(e){var t=this,a={status:!1};this.$Modal.confirm({title:"确认禁用",content:"您确认要禁用用户 "+e.username+" ?",loading:!0,onOk:function(){Object(s.x)(e.id,a).then(function(e){t.$Modal.remove(),e.success&&(t.$Message.success("操作成功"),t.getUserList())})}})},remove:function(e){var t=this;this.$Modal.confirm({title:"确认删除",content:"您确认要删除用户 "+e.username+" ?",loading:!0,onOk:function(){Object(s.s)(e.id).then(function(e){t.$Modal.remove(),e.success&&(t.$Message.success("删除成功"),t.getUserList())})}})},showSelect:function(e){this.exportData=e,this.selectList=e,this.selectCount=e.length},clearSelectAll:function(){this.$refs.table.selectAll(!1)},delAll:function(){var a=this;this.selectCount<=0?this.$Message.warning("您还未选择要删除的数据"):this.$Modal.confirm({title:"确认删除",content:"您确认要删除所选的 "+this.selectCount+" 条数据?",loading:!0,onOk:function(){var t="";a.selectList.forEach(function(e){t+=e.id+","}),t=t.substring(0,t.length-1),Object(s.s)(t).then(function(e){a.$Modal.remove(),e.success&&(a.$Message.success("删除成功"),a.clearSelectAll(),a.getUserList())})}})}},mounted:function(){this.init(),this.getRoleList()}},o=Object(n.a)(i,function(){var t=this,a=t._self._c;return a("div",{staticClass:"search"},[a("Card",[a("Form",{ref:"searchForm",staticClass:"search-form",attrs:{model:t.searchForm,inline:"","label-width":70}},[a("Form-item",{attrs:{label:"用户名"}},[a("Input",{staticStyle:{width:"200px"},attrs:{type:"text",placeholder:"请输入用户名",clearable:""},model:{value:t.searchForm.username,callback:function(e){t.$set(t.searchForm,"username",e)},expression:"searchForm.username"}})],1),a("Form-item",{attrs:{label:"联系方式"}},[a("Input",{staticStyle:{width:"200px"},attrs:{type:"text",placeholder:"请输入联系方式",clearable:""},model:{value:t.searchForm.mobile,callback:function(e){t.$set(t.searchForm,"mobile",e)},expression:"searchForm.mobile"}})],1),a("Form-item",{attrs:{label:"部门"}},[a("department-choose",{ref:"dep",staticStyle:{width:"150px"},on:{"on-change":t.handleSelectDep}})],1),a("Button",{staticClass:"search-btn",attrs:{type:"primary",icon:"ios-search"},on:{click:t.handleSearch}},[t._v("搜索")])],1),a("Row",{staticClass:"operation padding-row"},[a("Button",{attrs:{type:"primary"},on:{click:t.add}},[t._v("添加")]),a("Button",{on:{click:t.delAll}},[t._v("批量删除")]),a("Button",{on:{click:t.resetPass}},[t._v("重置密码")])],1),a("Table",{ref:"table",attrs:{loading:t.loading,border:"",columns:t.columns,data:t.data,sortable:"custom"},on:{"on-sort-change":t.changeSort,"on-selection-change":t.showSelect}}),a("Row",{staticClass:"mt_10",attrs:{type:"flex",justify:"end"}},[a("Page",{attrs:{current:t.searchForm.pageNumber,total:t.total,"page-size":t.searchForm.pageSize,"page-size-opts":[10,20,50],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":t.changePage,"on-page-size-change":t.changePageSize}})],1)],1),a("Modal",{attrs:{title:t.modalTitle,"mask-closable":!1,width:500,styles:{top:"30px"}},model:{value:t.userModalVisible,callback:function(e){t.userModalVisible=e},expression:"userModalVisible"}},[a("Form",{ref:"form",attrs:{model:t.form,"label-width":70,rules:t.formValidate}},[a("FormItem",{attrs:{label:"用户名",prop:"username"}},[a("Input",{attrs:{autocomplete:"off"},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}})],1),a("FormItem",{attrs:{label:"昵称",prop:"username"}},[a("Input",{attrs:{autocomplete:"off"},model:{value:t.form.nickName,callback:function(e){t.$set(t.form,"nickName",e)},expression:"form.nickName"}})],1),0==t.modalType?a("FormItem",{attrs:{label:"密码",prop:"password",error:t.errorPass}},[a("Input",{attrs:{type:"password",password:"",autocomplete:"off"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1):t._e(),a("FormItem",{attrs:{label:"邮箱",prop:"email"}},[a("Input",{model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),a("FormItem",{attrs:{label:"手机号",prop:"mobile"}},[a("Input",{model:{value:t.form.mobile,callback:function(e){t.$set(t.form,"mobile",e)},expression:"form.mobile"}})],1),a("Form-item",{attrs:{label:"头像",prop:"avatar"}},[a("upload-pic-input",{model:{value:t.form.avatar,callback:function(e){t.$set(t.form,"avatar",e)},expression:"form.avatar"}})],1),a("Form-item",{attrs:{label:"所属部门"}},[a("department-tree-choose",{ref:"depTree",on:{"on-change":t.handleSelectDepTree}})],1),a("FormItem",{attrs:{label:"角色",prop:"roles"}},[a("Select",{attrs:{multiple:""},model:{value:t.form.roles,callback:function(e){t.$set(t.form,"roles",e)},expression:"form.roles"}},t._l(t.roleList,function(e){return a("Option",{key:e.id,attrs:{value:e.id,label:e.name}})}),1)],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text"},on:{click:function(e){t.userModalVisible=!1}}},[t._v("取消")]),a("Button",{attrs:{type:"primary",loading:t.submitLoading},on:{click:t.submitUser}},[t._v("提交")])],1)],1)],1)},[],!1,null,null,null);t.default=o.exports},"7da6":function(e,t,a){"use strict";a("29a2")},b149:function(e,t,a){"use strict";a("2d45")},da7e:function(e,t,a){"use strict";var s=a("365c"),r={name:"uploadPicInput",props:{value:String,size:{default:"default",type:String},placeholder:{type:String,default:"图片链接"},showInput:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},maxlength:Number,icon:{type:String,default:"ios-cloud-upload-outline"}},data:function(){return{accessToken:{},currentValue:this.value,loading:!1,viewImage:!1,uploadFileUrl:s.nb}},methods:{init:function(){this.accessToken={accessToken:this.getStore("accessToken")}},handleFormatError:function(e){this.loading=!1,this.$Notice.warning({title:"不支持的文件格式",desc:"所选文件‘ "+e.name+" ’格式不正确, 请选择 .jpg .jpeg .png .gif .bmp格式文件"})},handleMaxSize:function(e){this.loading=!1,this.$Notice.warning({title:"文件大小过大",desc:"所选文件大小过大, 不得超过1M."})},beforeUpload:function(){return this.loading=!0},handleSuccess:function(e,t){this.loading=!1,e.success&&(this.currentValue=e.result,this.$emit("input",this.currentValue),this.$emit("on-change",this.currentValue))},handleError:function(e,t,a){this.loading=!1,this.$Message.error(e.toString())},handleChange:function(e){this.$emit("input",this.currentValue),this.$emit("on-change",this.currentValue),this.$attrs.rollback&&this.$attrs.rollback()},setCurrentValue:function(e){e!==this.currentValue&&(this.currentValue=e,this.$emit("on-change",this.currentValue))}},watch:{value:function(e){this.setCurrentValue(e)}},created:function(){this.init()}},a=(a("b149"),a("2877")),a=Object(a.a)(r,function(){var t=this,e=t._self._c;return e("div",[e("div",{staticStyle:{display:"flex"}},[e("Input",{directives:[{name:"show",rawName:"v-show",value:t.showInput,expression:"showInput"}],attrs:{placeholder:t.placeholder,size:t.size,disabled:t.disabled,readonly:t.readonly,maxlength:t.maxlength},on:{"on-change":t.handleChange},model:{value:t.currentValue,callback:function(e){t.currentValue=e},expression:"currentValue"}},[e("Poptip",{attrs:{slot:"append",transfer:"",trigger:"hover",title:"图片预览",placement:"right"},slot:"append"},[e("Icon",{staticClass:"see-icon",attrs:{type:"md-eye"}}),e("div",{attrs:{slot:"content"},slot:"content"},[e("img",{staticStyle:{width:"100%",margin:"0 auto",display:"block"},attrs:{src:t.currentValue,alt:"该资源不存在"}}),e("a",{staticStyle:{"margin-top":"5px","text-align":"right",display:"block"},on:{click:function(e){t.viewImage=!0}}},[t._v("查看大图")])])],1)],1),e("Upload",{ref:"up",staticClass:"upload",attrs:{action:t.uploadFileUrl,headers:t.accessToken,"on-success":t.handleSuccess,"on-error":t.handleError,format:["jpg","jpeg","png","gif","bmp"],accept:".jpg, .jpeg, .png, .gif, .bmp","max-size":1024,"on-format-error":t.handleFormatError,"on-exceeded-size":t.handleMaxSize,"before-upload":t.beforeUpload,"show-upload-list":!1}},[e("Button",{attrs:{loading:t.loading,size:t.size,disabled:t.disabled}},[t._v("上传图片")])],1)],1),e("Modal",{attrs:{title:"图片预览",styles:{top:"30px"},draggable:""},model:{value:t.viewImage,callback:function(e){t.viewImage=e},expression:"viewImage"}},[e("img",{staticStyle:{width:"100%",margin:"0 auto",display:"block"},attrs:{src:t.currentValue,alt:"该资源不存在"}}),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("Button",{on:{click:function(e){t.viewImage=!1}}},[t._v("关闭")])],1)])],1)},[],!1,null,"75ceb5cf",null);t.a=a.exports}}]);