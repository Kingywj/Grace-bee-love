(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-c327adc2"],{"0551":function(e,t,r){},2798:function(e,t,r){"use strict";r.r(t);var i=r("365c"),n=r("c276");function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(){S=function(){return a};var a={},e=Object.prototype,s=e.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",o=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o,i,a,l,t=t&&t.prototype instanceof d?t:d,t=Object.create(t.prototype),n=new w(n||[]);return t._invoke=(o=e,i=r,a=n,l="suspendedStart",function(e,t){if("executing"===l)throw new Error("Generator is already running");if("completed"===l){if("throw"===e)throw t;return x()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=t.iterator[r.method];if(void 0===n){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method))return u;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}n=c(n,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,u;n=n.arg;return n?n.done?(r[t.resultName]=n.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,u):n:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,u)}(r,a);if(r){if(r===u)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===l)throw l="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);l="executing";r=c(o,i,a);if("normal"===r.type){if(l=a.done?"completed":"suspendedYield",r.arg===u)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(l="completed",a.method="throw",a.arg=r.arg)}}),t}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=l;var u={};function d(){}function h(){}function p(){}var t={},f=(i(t,n,function(){return this}),Object.getPrototypeOf),f=f&&f(f(L([]))),m=(f&&f!==e&&s.call(f,n)&&(t=f),p.prototype=d.prototype=Object.create(t));function g(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function v(a,l){var t;this._invoke=function(r,n){function e(){return new l(function(e,t){!function t(e,r,n,o){var i,e=c(a[e],a,r);if("throw"!==e.type)return(r=(i=e.arg).value)&&"object"==k(r)&&s.call(r,"__await")?l.resolve(r.__await).then(function(e){t("next",e,n,o)},function(e){t("throw",e,n,o)}):l.resolve(r).then(function(e){i.value=e,n(i)},function(e){return t("throw",e,n,o)});o(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}}function y(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function b(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(y,this),this.reset(!0)}function L(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(s.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:x}}function x(){return{value:void 0,done:!0}}return i(m,"constructor",h.prototype=p),i(p,"constructor",h),h.displayName=i(p,o,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e},a.awrap=function(e){return{__await:e}},g(v.prototype),i(v.prototype,r,function(){return this}),a.AsyncIterator=v,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new v(l(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},g(m),i(m,o,"Generator"),i(m,n,function(){return this}),i(m,"toString",function(){return"[object Generator]"}),a.keys=function(r){var e,n=[];for(e in r)n.push(e);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=L,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=s.call(o,"catchLoc"),l=s.call(o,"finallyLoc");if(a&&l){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}var i=(o=o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc?null:o)?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),b(r),u}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,o=this.tryEntries[t];if(o.tryLoc===e)return"throw"===(r=o.completion).type&&(n=r.arg,b(o)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:L(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},a}function s(e,t,r,n,o,i,a){try{var l=e[i](a),s=l.value}catch(e){return r(e)}l.done?t(s):Promise.resolve(s).then(n,o)}var o={name:"role-manage",data:function(){var r=this;return{superModelLoading:!1,selectIsSuperModel:!1,rolePermsWay:[],openLevel:"0",loading:!0,treeLoading:!0,depTreeLoading:!0,submitPermLoading:!1,submitDepLoading:!1,sortColumn:"",sortType:"desc",modalType:0,roleModalVisible:!1,permModalVisible:!1,depModalVisible:!1,modalTitle:"",roleForm:{name:"",description:""},roleFormValidate:{name:[{required:!0,message:"角色名称不能为空",trigger:"blur"}]},submitLoading:!1,selectList:[],selectCount:0,columns:[{type:"selection",width:60,align:"center"},{title:"角色名称",key:"name",minWidth:150},{title:"备注",key:"description",minWidth:150,tooltip:!0},{title:"创建时间",key:"createTime",width:170,sortable:!0,sortType:"desc"},{title:"更新时间",key:"updateTime",width:170,sortable:!0},{title:"最后操作人",key:"createBy",width:150},{title:"操作",key:"action",align:"center",fixed:"right",width:230,render:function(e,t){return e("div",[e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){r.editPerm(t.row)}}},"菜单权限"),e("Button",{props:{size:"small",type:"info"},style:{marginRight:"5px"},on:{click:function(){r.edit(t.row)}}},"编辑"),e("Button",{props:{type:"error",size:"small"},on:{click:function(){r.remove(t.row)}}},"删除")])}}],data:[],pageNumber:1,pageSize:10,total:0,permData:[],editRolePermId:"",selectAllFlag:!1,depData:[],dataType:0,editDepartments:[],saveRoleWay:[]}},methods:{init:function(){this.getRoleList(),this.getPermList()},renderContent:function(e,t){t.root,t.node;t=t.data;return e("span",{style:{display:"inline-block",cursor:"pointer"}},[e("span",[e("Icon",{props:{type:0==t.level?"ios-navigate":1==t.level?"md-list-box":2==t.level?"md-list":3==t.level?"md-radio-button-on":"md-radio-button-off",size:"16"},style:{"margin-right":"8px","margin-bottom":"3px"}}),e("span",t.title),e("Tag",{props:{color:1==t.isSuper?"red":(t.isSuper,"default")},style:{"margin-left":"10px",display:1==t.isSuper||0==t.isSuper?"inline-block":"none"}},1==t.isSuper?"操作权限":0==t.isSuper?"查看权限":"")])])},changePage:function(e){this.pageNumber=e,this.getRoleList(),this.clearSelectAll()},changePageSize:function(e){this.pageNumber=1,this.pageSize=e,this.getRoleList()},changeSort:function(e){this.sortColumn=e.key,this.sortType=e.order,"normal"==e.order&&(this.sortType=""),this.getRoleList()},setRole:function(e){var t="onlyView"==e?0:1;this.saveRoleWay.map(function(e){e.isSuper=t})},getRoleList:function(){var t=this,e=(this.loading=!0,{pageNumber:this.pageNumber,pageSize:this.pageSize,sort:this.sortColumn,order:this.sort});Object(i.L)(e).then(function(e){t.loading=!1,e.success&&(t.data=e.result.records,t.total=e.result.total)})},getPermList:function(){var t=this;this.treeLoading=!0,Object(i.y)().then(function(e){e.success&&(t.deleteDisableNode(e.result),t.permData=e.result,t.treeLoading=!1),t.treeLoading=!1})},deleteDisableNode:function(e){var t=this;e.forEach(function(e){-1==e.status&&(e.title="[已禁用] "+e.title,e.disabled=!0),e.children&&0<e.children.length&&t.deleteDisableNode(e.children)})},submitRole:function(){var t=this;this.$refs.roleForm.validate(function(e){e&&(0==t.modalType?(t.submitLoading=!0,Object(i.e)(t.roleForm).then(function(e){t.submitLoading=!1,e.success&&(t.$Message.success("操作成功"),t.getRoleList(),t.roleModalVisible=!1)})):(t.submitLoading=!0,t.roleForm.roleId=t.roleForm.id,Object(i.w)(t.roleForm).then(function(e){t.submitLoading=!1,e.success&&(t.$Message.success("操作成功"),t.getRoleList(),t.roleModalVisible=!1)})))})},addRole:function(){this.modalType=0,this.modalTitle="添加角色",this.$refs.roleForm.resetFields(),delete this.roleForm.id,this.roleModalVisible=!0},edit:function(e){for(var t in this.modalType=1,this.modalTitle="编辑角色",this.$refs.roleForm.resetFields(),e)null==e[t]&&(e[t]="");var r=JSON.stringify(e),r=JSON.parse(r);this.roleForm=r,this.roleModalVisible=!0},remove:function(e){var t=this;this.$Modal.confirm({title:"确认删除",content:"您确认要删除角色 "+e.name+" ?",loading:!0,onOk:function(){Object(i.r)(e.id).then(function(e){t.$Modal.remove(),e.success&&(t.$Message.success("删除成功"),t.getRoleList())})}})},clearSelectAll:function(){this.$refs.table.selectAll(!1)},changeSelect:function(e){this.selectList=e,this.selectCount=e.length},delAll:function(){var r=this;this.selectCount<=0?this.$Message.warning("您还未选择要删除的数据"):this.$Modal.confirm({title:"确认删除",content:"您确认要删除所选的 "+this.selectCount+" 条数据?",loading:!0,onOk:function(){var t="";r.selectList.forEach(function(e){t+=e.id+","}),t=t.substring(0,t.length-1),Object(i.r)(t).then(function(e){r.$Modal.remove(),e.success&&(r.$Message.success("删除成功"),r.clearSelectAll(),r.getRoleList())})}})},editPerm:function(n){var l,o=this;return l=S().mark(function e(){var t,r;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o.permData.map(function(e){0!=e.children.length&&e.children.map(function(e){0!=e.children.length&&e.children.map(function(e){delete e.isSuper}),delete e.isSuper}),delete e.isSuper}),o.treeLoading)return o.$Message.warning("菜单权限数据加载中，请稍后点击查看"),e.abrupt("return");e.next=4;break;case 4:return o.editRolePermId=n.id,o.modalTitle="分配 "+n.name+" 的菜单权限",e.next=8,Object(i.fb)(n.id);case 8:(r=e.sent).result&&(t=r.result,o.rolePermsWay=r.result),o.checkPermTree(o.permData,t),o.permModalVisible=!0;case 12:case"end":return e.stop()}},e)}),function(){var e=this,a=arguments;return new Promise(function(t,r){var n=l.apply(e,a);function o(e){s(n,t,r,o,i,"next",e)}function i(e){s(n,t,r,o,i,"throw",e)}o(void 0)})}()},checkPermTree:function(e,t){var r=this,n=this;e.forEach(function(e){n.hasPerm(e,t)&&-1!=e.status?e.children&&0===e.children.length&&r.$set(e,"checked",!0):r.$set(e,"checked",!1),e.children&&0<e.children.length&&n.checkPermTree(e.children,t)})},hasPerm:function(e,t){if(!t)return!1;for(var r=!1,n=0;n<t.length;n++)if(e.id==t[n].menuId){this.$set(e,"isSuper",t[n].isSuper),r=!0;break}return!!r},selectedTreeAll:function(e,t){var r=this;e.forEach(function(e){e.checked=t,e.children&&0<e.children.length&&r.selectedTreeAll(e.children,t)})},submitPermEdit:function(){var t=this,e=(this.saveRoleWay=[],this.selectIsSuperModel=!0,this.$refs.tree.getCheckedAndIndeterminateNodes()),r=[];e.forEach(function(e){e={title:e.title,isSuper:e.isSuper?e.isSuper=1:e.isSuper=0,menuId:e.id,roleId:t.editRolePermId};r.push(e),t.$set(t,"saveRoleWay",r)})},saveRole:function(){var t=this;this.superModelLoading=!0,Object(i.cb)(this.editRolePermId,this.saveRoleWay).then(function(e){t.superModelLoading=!1,e.success&&(t.$Message.success("操作成功"),t.$store.commit("setAdded",!1),n.a.initRouter(t),t.getRoleList(),t.permModalVisible=!1)})},loadData:function(e,t){Object(i.X)(e.id,{openDataFilter:!1}).then(function(e){e.success&&(e.result.forEach(function(e){e.checked=!1,e.isParent&&(e.loading=!1,e.children=[]),-1==e.status&&(e.title="[已禁用] "+e.title,e.disabled=!0)}),t(e.result))})},expandCheckDep:function(e){this.checkDepTree(e.children,this.editDepartments)},checkDepTree:function(e,t){var r=this;e.forEach(function(e){r.hasDepPerm(e,t)?e.checked=!0:e.checked=!1})},changeOpen:function(e){"0"==e?this.permData.forEach(function(e){e.expand=!0,e.children&&0<e.children.length&&e.children.forEach(function(e){e.expand=!0,e.children&&0<e.children.length&&e.children.forEach(function(e){e.expand=!0})})}):"1"==e?this.permData.forEach(function(e){e.expand=!1,e.children&&0<e.children.length&&e.children.forEach(function(e){e.expand=!1,e.children&&0<e.children.length&&e.children.forEach(function(e){e.expand=!1})})}):"2"==e?this.permData.forEach(function(e){e.expand=!0,e.children&&0<e.children.length&&e.children.forEach(function(e){e.expand=!1,e.children&&0<e.children.length&&e.children.forEach(function(e){e.expand=!1})})}):"3"==e&&this.permData.forEach(function(e){e.expand=!0,e.children&&0<e.children.length&&e.children.forEach(function(e){e.expand=!0,e.children&&0<e.children.length&&e.children.forEach(function(e){e.expand=!1})})})}},mounted:function(){this.init()}},r=(r("4c91"),r("2877")),r=Object(r.a)(o,function(){var r=this,n=r._self._c;return n("div",{staticClass:"search"},[n("Card",[n("Row",{staticClass:"operation"},[n("Button",{attrs:{type:"primary"},on:{click:r.addRole}},[r._v("添加角色")]),n("Button",{on:{click:r.delAll}},[r._v("批量删除")])],1),n("Table",{ref:"table",attrs:{loading:r.loading,border:"",columns:r.columns,data:r.data,sortable:"custom"},on:{"on-sort-change":r.changeSort,"on-selection-change":r.changeSelect}}),n("Row",{staticClass:"mt_10",attrs:{type:"flex",justify:"end"}},[n("Page",{attrs:{current:r.pageNumber,total:r.total,"page-size":r.pageSize,"page-size-opts":[10,20,50],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":r.changePage,"on-page-size-change":r.changePageSize}})],1)],1),n("Modal",{attrs:{title:r.modalTitle,"mask-closable":!1,width:500},model:{value:r.roleModalVisible,callback:function(e){r.roleModalVisible=e},expression:"roleModalVisible"}},[n("Form",{ref:"roleForm",attrs:{model:r.roleForm,"label-width":80,rules:r.roleFormValidate}},[n("FormItem",{attrs:{label:"角色名称",prop:"name"}},[n("Input",{model:{value:r.roleForm.name,callback:function(e){r.$set(r.roleForm,"name",e)},expression:"roleForm.name"}})],1),n("FormItem",{attrs:{label:"备注",prop:"description"}},[n("Input",{model:{value:r.roleForm.description,callback:function(e){r.$set(r.roleForm,"description",e)},expression:"roleForm.description"}})],1)],1),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"text"},on:{click:function(e){r.roleModalVisible=!1}}},[r._v("取消")]),n("Button",{attrs:{type:"primary",loading:r.submitLoading},on:{click:r.submitRole}},[r._v("提交 ")])],1)],1),n("Modal",{staticClass:"permModal",attrs:{title:r.modalTitle,"mask-closable":!1,width:500,styles:{top:"30px"}},model:{value:r.permModalVisible,callback:function(e){r.permModalVisible=e},expression:"permModalVisible"}},[n("div",{staticStyle:{position:"relative"}},[n("Tree",{ref:"tree",attrs:{data:r.permData,"show-checkbox":"",render:r.renderContent}}),r.treeLoading?n("Spin",{attrs:{size:"large",fix:""}}):r._e()],1),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"text"},on:{click:function(e){r.permModalVisible=!1}}},[r._v("取消")]),n("Select",{staticStyle:{width:"110px","text-align":"left","margin-right":"10px"},on:{"on-change":r.changeOpen},model:{value:r.openLevel,callback:function(e){r.openLevel=e},expression:"openLevel"}},[n("Option",{attrs:{value:"0"}},[r._v("展开所有")]),n("Option",{attrs:{value:"1"}},[r._v("收合所有")]),n("Option",{attrs:{value:"2"}},[r._v("仅展开一级")]),n("Option",{attrs:{value:"3"}},[r._v("仅展开两级")])],1),n("Button",{attrs:{type:"primary",loading:r.submitPermLoading},on:{click:function(e){return r.submitPermEdit()}}},[r._v("编辑 ")])],1)]),n("Modal",{attrs:{width:"800",title:"选择菜单权限",loading:r.superModelLoading},on:{"on-ok":r.saveRole},model:{value:r.selectIsSuperModel,callback:function(e){r.selectIsSuperModel=e},expression:"selectIsSuperModel"}},[n("div",{staticClass:"btns"},[n("Button",{staticClass:"btn-item",attrs:{type:"primary"},on:{click:function(e){return r.setRole()}}},[r._v("一键选中·数据权限")]),n("Button",{staticClass:"btn-item",on:{click:function(e){return r.setRole("onlyView")}}},[r._v("一键选中·查看权限")])],1),n("div",{staticClass:"role-list"},r._l(r.saveRoleWay,function(t,e){return n("div",{key:e,staticClass:"role-item"},[n("div",{staticClass:"title"},[r._v(r._s(t.title))]),n("div",{staticClass:"content"},[n("RadioGroup",{attrs:{type:"button","button-style":"solid"},model:{value:t.isSuper,callback:function(e){r.$set(t,"isSuper",e)},expression:"item.isSuper"}},[n("Radio",{attrs:{label:1}},[n("span",[r._v("操作数据权限")])]),n("Radio",{attrs:{label:0}},[n("span",[r._v("查看权限")])])],1)],1)])}),0)])],1)},[],!1,null,"31808037",null);t.default=r.exports},"4c91":function(e,t,r){"use strict";r("0551")}}]);