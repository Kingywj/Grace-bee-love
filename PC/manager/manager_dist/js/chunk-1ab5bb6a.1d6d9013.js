(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1ab5bb6a","chunk-0173f062"],{3881:function(t,e,o){"use strict";o.r(e);var i=o("3f9b"),n=o("bb7b"),s=o("f74c"),r=o("90e0"),i={name:"add-coupon-activity",components:{couponTemplate:i.default,userList:n.default},data:function(){var o=this;return{options:{disabledDate:function(t){return t&&t.valueOf()<Date.now()-864e5}},showCouponSelect:!1,rangeTime:"",checkUserList:!1,selectedMember:[],form:{promotionName:"",activityScope:"ALL",couponActivityType:"REGISTERED",startTime:"",endTime:"",memberDTOS:[],couponActivityItems:[]},submitLoading:!1,selectCouponList:[],formRule:{promotionName:[{required:!0,message:"活动名称不能为空"}],rangeTime:[{required:!0,message:"请选择活动有效期"}],description:[{required:!0,message:"请输入范围描述"}]},userColumns:[{title:"用户名称",key:"nickName",minWidth:120},{title:"手机号",key:"mobile",render:function(t,e){return t("div",e.row.mobile||"暂未填写")}},{title:"最后登录时间",key:"lastLoginDate"},{title:"操作",key:"action",minWidth:50,align:"center",render:function(t,e){return t("Button",{props:{size:"small",type:"error",ghost:!0},on:{click:function(){o.delUser(e.index)}}},"删除")}}],columns:[{title:"优惠券名称",key:"couponName",minWidth:120},{title:"品类描述",key:"scopeType",width:120,render:function(t,e){return Object(r.a)(t,e)}},{title:"面额/折扣",key:"couponName",minWidth:120,render:function(t,e){return e.row.price?t("div",o.$options.filters.unitPrice(e.row.price,"￥")):t("div",e.row.couponDiscount+"折")}},{title:"赠送数量",type:"template",slot:"sendNum",minWidth:120},{title:"操作",key:"action",minWidth:50,align:"center",render:function(t,e){return t("Button",{props:{size:"small",type:"error",ghost:!0},on:{click:function(){o.delCoupon(e.index)}}},"删除")}}]}},methods:{callbackSelectUser:function(e){var o=this,i=this.selectedMember.find(function(t){return t.id===e.id});i?this.selectedMember.map(function(t,e){t.id===i.id&&o.selectedMember.splice(e,1)}):this.selectedMember.push(e),this.reSelectMember()},delUser:function(t){this.selectedMember.splice(t,1),this.reSelectMember()},reSelectMember:function(){this.form.memberDTOS=this.selectedMember.map(function(t){return{nickName:t.nickName,id:t.id}})},selectedCoupon:function(t){this.selectCouponList=t,this.reSelectCoupon()},delCoupon:function(t){this.selectCouponList.splice(t,1),this.reSelectCoupon()},reSelectCoupon:function(){this.form.couponActivityItems=this.selectCouponList.map(function(t){return{num:0,couponId:t.id}})},addVip:function(){var t=this;this.checkUserList=!0,this.$nextTick(function(){t.$refs.memberLayout.selectedMember=!0})},showSelector:function(){this.showCouponSelect=!0},handleSubmit:function(){var e=this;this.form.startTime=this.$options.filters.unixToDate(this.rangeTime[0]/1e3),this.form.endTime=this.$options.filters.unixToDate(this.rangeTime[1]/1e3),this.$refs.form.validate(function(t){t&&(t=JSON.parse(JSON.stringify(e.form)),e.submitLoading=!0,delete t.id,Object(s.E)(t).then(function(t){e.submitLoading=!1,t.success&&(e.$Message.success("优惠券活动创建成功"),e.closeCurrentPage())}))})},closeCurrentPage:function(){this.$store.commit("removeTag","add-platform-coupon"),localStorage.pageOpenedList=JSON.stringify(this.$store.state.app.pageOpenedList),this.$router.go(-1)}}},n=(o("81b08"),o("2877")),o=Object(n.a)(i,function(){var t=this,o=this,i=o._self._c;return i("div",[i("Card",[i("Form",{ref:"form",attrs:{model:o.form,"label-width":120,rules:o.formRule}},[i("div",{staticClass:"base-info-item"},[i("h4",[o._v("活动信息")]),i("div",{staticClass:"form-item-view"},[i("FormItem",{attrs:{label:"活动名称",prop:"promotionName"}},[i("Input",{staticStyle:{width:"260px"},attrs:{type:"text",placeholder:"请填写活动名称",clearable:""},model:{value:o.form.promotionName,callback:function(t){o.$set(o.form,"promotionName",t)},expression:"form.promotionName"}})],1),i("FormItem",{attrs:{label:"活动时间"}},[i("DatePicker",{staticStyle:{width:"260px"},attrs:{type:"datetimerange",options:o.options,format:"yyyy-MM-dd HH:mm:ss",placeholder:"请选择活动时间"},model:{value:o.rangeTime,callback:function(t){o.rangeTime=t},expression:"rangeTime"}})],1),i("FormItem",{attrs:{label:"优惠券活动类型",prop:"couponActivityType"}},[i("RadioGroup",{attrs:{type:"button","button-style":"solid"},model:{value:o.form.couponActivityType,callback:function(t){o.$set(o.form,"couponActivityType",t)},expression:"form.couponActivityType"}},[i("Radio",{attrs:{label:"REGISTERED"}},[o._v("新人发券")]),i("Radio",{attrs:{label:"SPECIFY"}},[o._v("精确发券")])],1)],1),"SPECIFY"===o.form.couponActivityType?i("FormItem",{attrs:{label:"活动范围",prop:"activityScope"}},[i("RadioGroup",{attrs:{type:"button","button-style":"solid"},model:{value:o.form.activityScope,callback:function(t){o.$set(o.form,"activityScope",t)},expression:"form.activityScope"}},[i("Radio",{attrs:{label:"ALL"}},[o._v("全部会员")]),i("Radio",{attrs:{label:"DESIGNATED"}},[o._v("指定会员")])],1)],1):o._e(),"SPECIFY"===o.form.couponActivityType&&"DESIGNATED"===o.form.activityScope?i("FormItem",{attrs:{label:"选择会员",prop:"scopeType"}},[i("Button",{attrs:{type:"primary",icon:"ios-add",ghost:""},on:{click:o.addVip}},[o._v("选择会员")]),"DESIGNATED"==o.form.activityScope?i("div",{staticStyle:{"margin-top":"24px"}},[i("Table",{attrs:{border:"",columns:o.userColumns,data:this.selectedMember}})],1):o._e()],1):o._e()],1),i("h4",[o._v("配置优惠券")]),i("div",{staticClass:"form-item-view"},[i("FormItem",{attrs:{label:"选择优惠券",prop:"scopeType"}},[i("Button",{attrs:{type:"primary",loading:o.submitLoading},on:{click:o.showSelector}},[o._v("选择优惠券")])],1),i("FormItem",{attrs:{label:"赠送配置",prop:"scopeType"}},[i("Table",{attrs:{border:"",columns:o.columns,data:this.selectCouponList},scopedSlots:o._u([{key:"sendNum",fn:function(e){return[i("Input",{attrs:{type:"text",placeholder:"赠送数量"},model:{value:o.form.couponActivityItems[e.index].num,callback:function(t){o.$set(o.form.couponActivityItems[e.index],"num",t)},expression:"form.couponActivityItems[scope.index].num"}}),i("Input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{type:"text"},model:{value:o.form.couponActivityItems[e.index].couponId,callback:function(t){o.$set(o.form.couponActivityItems[e.index],"couponId",t)},expression:"form.couponActivityItems[scope.index].couponId"}})]}}])})],1),i("div",[i("Button",{attrs:{type:"text"},on:{click:o.closeCurrentPage}},[o._v("返回")]),i("Button",{attrs:{type:"primary",loading:o.submitLoading},on:{click:o.handleSubmit}},[o._v("提交")])],1)],1)])])],1),i("Modal",{attrs:{width:"80%"},on:{"on-ok":function(){t.showCouponSelect=!1},"on-cancel":function(){t.showCouponSelect=!1}},model:{value:o.showCouponSelect,callback:function(t){o.showCouponSelect=t},expression:"showCouponSelect"}},[i("couponTemplate",{attrs:{checked:!0,selectedList:o.selectCouponList,getType:"ACTIVITY",promotionStatus:"START"},on:{selected:o.selectedCoupon}})],1),i("Modal",{attrs:{width:"1200"},model:{value:o.checkUserList,callback:function(t){o.checkUserList=t},expression:"checkUserList"}},[o.checkUserList?i("userList",{ref:"memberLayout",attrs:{selectedList:o.selectedMember},on:{callback:o.callbackSelectUser}}):o._e()],1)],1)},[],!1,null,null,null);e.default=o.exports},"3f9b":function(t,e,o){"use strict";o.r(e);var i=o("f74c"),n=o("90e0"),s={name:"coupon",data:function(){var o=this;return{loading:!0,searchForm:{pageNumber:1,pageSize:10,sort:"create_time",order:"desc",getType:""},selectList:[],selectCount:0,columns:[{type:"selection",width:60,align:"center",fixed:"left"},{title:"活动名称",key:"promotionName",minWidth:100,fixed:"left"},{title:"优惠券名称",key:"couponName",minWidth:100,tooltip:!0},{title:"面额/折扣",key:"price",width:100,render:function(t,e){return e.row.price?t("div",o.$options.filters.unitPrice(e.row.price,"￥")):t("div",e.row.couponDiscount+"折")}},{title:"已领取数量/总数量",key:"publishNum",width:130,render:function(t,e){return t("div",e.row.receivedNum+"/"+(0===e.row.publishNum?"不限制":e.row.publishNum))}},{title:"已被使用的数量/已领取数量",key:"publishNum",render:function(t,e){return t("div",e.row.usedNum+"/"+e.row.receivedNum)}},{title:"优惠券类型",key:"couponType",width:120,render:function(t,e){return"DISCOUNT"===e.row.couponType?t("Tag",{props:{color:"blue"}},"打折"):"PRICE"===e.row.couponType?t("Tag",{props:{color:"geekblue"}},"减免现金"):t("Tag",{props:{color:"purple"}},"未知")}},{title:"品类描述",key:"scopeType",width:120,render:function(t,e){return Object(n.a)(t,e)}},{title:"活动时间",width:150,render:function(t,e){var o;return"ACTIVITY"===(null==e||null==(o=e.row)?void 0:o.getType)&&"DYNAMICTIME"===(null==e||null==(o=e.row)?void 0:o.rangeDayType)?t("div","长期有效"):null!=e&&null!=(o=e.row)&&o.startTime&&null!=e&&null!=(o=e.row)&&o.endTime?t("div",{domProps:{innerHTML:e.row.startTime+"<br/>"+e.row.endTime}}):void 0}},{title:"状态",width:100,key:"promotionStatus",fixed:"right",render:function(t,e){return Object(n.b)(t,e)},minWidth:70},{title:"操作",slot:"action",align:"center",fixed:"right",width:130}],data:[],total:0,refreshTable:!0,selectDate:[]}},props:{getType:{type:String,default:""},promotionStatus:{type:String,default:""},selectedList:{type:Array,default:function(){return[]}}},watch:{$route:function(t,e){"/promotions/manager-coupon"==t.fullPath&&this.init()},selectedList:{handler:function(t){var o=this;t.length?(this.selectList=t,this.data.forEach(function(e){e._checked=!1,o.selectList.length&&o.selectList.forEach(function(t){e.id==t.id&&(e._checked=!0)})})):this.data.forEach(function(t){t._checked=!1}),this.refreshTable=!1,this.$nextTick(function(){o.refreshTable=!0})},deep:!0}},methods:{check:function(){this.$emit("selected",this.selectList)},init:function(){this.getDataList()},add:function(){this.$router.push({name:"add-platform-coupon"})},info:function(t){this.$router.push({name:"platform-coupon-info",query:{id:t.id}})},changePage:function(t){this.searchForm.pageNumber=t,this.getDataList()},changePageSize:function(t){this.searchForm.pageNumber=1,this.searchForm.pageSize=t,this.getDataList()},handleSearch:function(){this.searchForm.pageNumber=1,this.searchForm.pageSize=10,this.getDataList()},clearSelectAll:function(){this.$refs.table.selectAll(!1)},changeSelect:function(t){this.selectList=t,this.selectCount=t.length,"ACTIVITY"===this.getType&&this.check()},getDataList:function(){var e=this;this.loading=!0,this.selectDate&&this.selectDate[0]&&this.selectDate[1]?(this.searchForm.startTime=this.selectDate[0].getTime(),this.searchForm.endTime=this.selectDate[1].getTime()):(this.searchForm.startTime=null,this.searchForm.endTime=null),Object(i.z)(this.searchForm).then(function(t){e.loading=!1,t.success&&(e.data=t.result.records,e.total=t.result.total)}),this.total=this.data.length,this.loading=!1},see:function(t,e){e=e?{onlyView:!0,id:t.id}:{id:t.id};this.$router.push({name:"edit-platform-coupon",query:e})},close:function(t){var e=this;this.$Modal.confirm({title:"确认关闭",content:"确认要关闭此优惠券么?",loading:!0,onOk:function(){Object(i.L)({couponIds:t.id,effectiveDays:0}).then(function(t){e.$Modal.remove(),t.success&&(e.$Message.success("优惠券已关闭"),e.getDataList())}).catch(function(){e.$Modal})}})},remove:function(t){var e=this;this.$Modal.confirm({title:"确认删除",content:"确认要删除此优惠券么?",loading:!0,onOk:function(){Object(i.g)(t.id).then(function(t){e.$Modal.remove(),t.success&&(e.$Message.success("优惠券已删除"),e.getDataList())}).catch(function(){e.$Modal})}})},delAll:function(){var o=this;this.selectCount<=0?this.$Message.warning("您还未选择要下架的优惠券"):this.$Modal.confirm({title:"确认下架",content:"您确认要下架所选的 "+this.selectCount+" 条数据?",loading:!0,onOk:function(){var e=[],t=(o.selectList.forEach(function(t){e.push(t.id)}),{couponIds:e.toString(),promotionStatus:"CLOSE"});Object(i.L)(t).then(function(t){o.$Modal.remove(),t.success&&(o.$Message.success("下架成功"),o.clearSelectAll(),o.getDataList())})}})}},mounted:function(){this.getType&&(this.searchForm.getType=this.getType,this.columns.pop()),this.promotionStatus&&(this.searchForm.promotionStatus=this.promotionStatus,this.columns.pop()),this.init()}},o=o("2877"),o=Object(o.a)(s,function(){var o=this,i=o._self._c;return i("div",{staticClass:"search"},[i("Card",[i("Form",{ref:"searchForm",staticClass:"search-form mb_10",attrs:{model:o.searchForm,inline:"","label-width":75}},[i("Form-item",{attrs:{label:"优惠券名称",prop:"couponName"}},[i("Input",{staticStyle:{width:"200px"},attrs:{type:"text",placeholder:"请输入优惠券名称",clearable:""},model:{value:o.searchForm.couponName,callback:function(t){o.$set(o.searchForm,"couponName",t)},expression:"searchForm.couponName"}})],1),i("Form-item",{attrs:{label:"活动状态",prop:"promotionStatus"}},[i("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择",clearable:""},model:{value:o.searchForm.promotionStatus,callback:function(t){o.$set(o.searchForm,"promotionStatus",t)},expression:"searchForm.promotionStatus"}},[i("Option",{attrs:{value:"NEW"}},[o._v("未开始")]),i("Option",{attrs:{value:"START"}},[o._v("已开始/上架")]),i("Option",{attrs:{value:"END"}},[o._v("已结束/下架")]),i("Option",{attrs:{value:"CLOSE"}},[o._v("紧急关闭/作废")])],1)],1),i("Form-item",{attrs:{label:"活动时间"}},[i("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"daterange",clearable:"",placeholder:"选择起始时间"},model:{value:o.selectDate,callback:function(t){o.selectDate=t},expression:"selectDate"}})],1),i("Button",{staticClass:"search-btn",attrs:{type:"primary",icon:"ios-search"},on:{click:o.handleSearch}},[o._v("搜索")])],1),"ACTIVITY"!==o.getType?i("Row",{staticClass:"operation padding-row"},[i("Button",{attrs:{type:"primary"},on:{click:o.add}},[o._v("添加优惠券")]),i("Button",{on:{click:o.delAll}},[o._v("批量关闭")])],1):o._e(),o.refreshTable?i("Table",{ref:"table",staticClass:"mt_10",attrs:{loading:o.loading,border:"",columns:o.columns,data:o.data},on:{"on-selection-change":o.changeSelect},scopedSlots:o._u([{key:"action",fn:function(t){var e=t.row;return["CLOSE"===e.promotionStatus||"NEW"===e.promotionStatus?i("Button",{attrs:{type:"info",size:"small"},on:{click:function(t){return o.see(e)}}},[o._v("编辑 ")]):i("Button",{attrs:{type:"default",size:"small"},on:{click:function(t){return o.see(e,"onlyView")}}},[o._v("查看 ")]),"START"===e.promotionStatus||"NEW"===e.promotionStatus?i("Button",{staticClass:"ml_5",attrs:{type:"error",size:"small"},on:{click:function(t){return o.close(e)}}},[o._v("关闭 ")]):o._e(),"CLOSE"===e.promotionStatus||"END"===e.promotionStatus?i("Button",{staticClass:"ml_5",attrs:{type:"error",size:"small"},on:{click:function(t){return o.remove(e)}}},[o._v("删除 ")]):o._e()]}}],null,!1,2781314451)}):o._e(),i("Row",{staticClass:"mt_10",attrs:{type:"flex",justify:"end"}},[i("Page",{attrs:{current:o.searchForm.pageNumber,total:o.total,"page-size":o.searchForm.pageSize,"page-size-opts":[10,20,50],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":o.changePage,"on-page-size-change":o.changePageSize}})],1)],1)],1)},[],!1,null,null,null);e.default=o.exports},"81b08":function(t,e,o){"use strict";o("b38e")},"90e0":function(t,e,o){"use strict";function i(t,e){var o="未知",i="red";return"NEW"==e.row.promotionStatus?(o="未开始",i="geekblue"):"START"==e.row.promotionStatus?(o="已开始",i="green"):"END"==e.row.promotionStatus?(o="已结束",i="red"):"CLOSE"==e.row.promotionStatus&&(o="已关闭",i="red"),t("div",[t("Tag",{props:{color:i}},o)])}function n(t,e){var o="未知",i="red";return"ALL"==e.row.scopeType?(o="全品类",i="default"):"PORTION_GOODS_CATEGORY"==e.row.scopeType?(o="商品分类",i="yellow"):"PORTION_SHOP_CATEGORY"==e.row.scopeType?(o="店铺分类",i="pink"):"PORTION_GOODS"==e.row.scopeType&&(o="指定商品",i="magenta"),t("div",[t("Tag",{props:{color:i}},o)])}o.d(e,"b",function(){return i}),o.d(e,"a",function(){return n})},b38e:function(t,e,o){}}]);